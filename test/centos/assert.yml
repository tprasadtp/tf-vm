---
- name: Validate
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Gather Net Facts
      virt_net:
        name: default
        command: info
      register: lv_netinfo
      tags:
        - net
    - debug:
        msg: "{{ lv_netinfo }}"
        verbosity: 2
      tags:
        - net
    - name: Assert | Network
      assert:
        that:
          - lv_netinfo.networks.default.state == "active"
          - lv_netinfo.networks.default.forward_mode == "nat"
          - lv_netinfo.networks.default.autostart == "yes"
        success_msg: "Network default (NAT) is up and running"
        fail_msg: "Network default (NAT) is not up and running"
      tags:
        - assert
        - net
    - name: Gather VM Info
      virt:
        command: info
      register: lv_viminfo
      tags:
        - vm
    - name: Assert | VMs ar Running
      assert:
        that:
          - lv_viminfo.centos1.memory == "524288"
          - lv_viminfo.centos1.state == "running"
          - lv_viminfo.centos1.nrVirtCpu == 1
        success_msg: "Centos VM is up and running"
        fail_msg: "One or more VMs failed to run with right config"
      tags:
        - vm
